<Window x:Class="VPM.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VPM"
        xmlns:System="clr-namespace:System;assembly=mscorlib"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        Title="VPM - Ready" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/icon.ico"
        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" 
                      ResizeBorderThickness="5" 
                      GlassFrameThickness="0"
                      CornerRadius="8"/>
    </WindowChrome.WindowChrome>
    <Window.Resources>
        <CollectionViewSource x:Key="PackagesView" />
        <CollectionViewSource x:Key="ScenesView" />
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <local:ContentCountsConverter x:Key="ContentCountsConverter"/>
        <System:Double x:Key="FilterToggleButtonSize">27</System:Double>
        <System:Double x:Key="LinkedButtonHeight">36</System:Double>
        
        <!-- Global Button Style with Blue Border Hover Effect -->
        <Style x:Key="BlueHoverButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="{StaticResource CornerRadiusValue}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="#FF0078D7"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#007ACC"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Universal Scrollbar Style for all scrollbars -->
        <Style TargetType="{x:Type ScrollBar}">
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <!-- Vertical Scrollbar -->
                <Trigger Property="Orientation" Value="Vertical">
                    <Setter Property="Width" Value="6"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type ScrollBar}">
                                <Grid Background="Transparent" Margin="3,3,0,0">
                                    <Track Name="PART_Track" IsDirectionReversed="True">
                                        <Track.DecreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageUpCommand" Opacity="0" Background="Transparent"/>
                                        </Track.DecreaseRepeatButton>
                                        <Track.Thumb>
                                            <Thumb MinHeight="60">
                                                <Thumb.Style>
                                                    <Style TargetType="Thumb">
                                                        <Setter Property="Background" Value="#40808080"/>
                                                        <Setter Property="BorderThickness" Value="0"/>
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="Thumb">
                                                                    <Border Background="{TemplateBinding Background}" 
                                                                            CornerRadius="{StaticResource CornerRadiusValue}" 
                                                                            Margin="3,0,3,0"/>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#60808080"/>
                                                            </Trigger>
                                                            <Trigger Property="IsDragging" Value="True">
                                                                <Setter Property="Background" Value="#80808080"/>
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Thumb.Style>
                                            </Thumb>
                                        </Track.Thumb>
                                        <Track.IncreaseRepeatButton>
                                            <RepeatButton Command="ScrollBar.PageDownCommand" Opacity="0" Background="Transparent"/>
                                        </Track.IncreaseRepeatButton>
                                    </Track>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <!-- Horizontal Scrollbar -->
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Height" Value="0"/>
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Setter Property="IsEnabled" Value="False"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type ScrollBar}">
                                <!-- Completely empty template to hide horizontal scrollbar -->
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Enhanced filter scrollbar style with live dragging support -->
        <Style x:Key="FilterScrollBarStyle" TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource {x:Type ScrollBar}}">
            <!-- Use default WPF scrollbar with system colors and live dragging -->
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
            <Style.Triggers>
                <!-- Hide horizontal scrollbars entirely inside the filter panel -->
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Height" Value="0"/>
                    <Setter Property="Visibility" Value="Collapsed"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Simple DataGrid scrollbar style - uses default WPF scrollbar with dark theme colors -->
        <Style x:Key="DataGridScrollBarStyle" TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource {x:Type ScrollBar}}">
            <!-- Dark theme colors for better visibility -->
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Style.Triggers>
                <!-- Hide horizontal scrollbars -->
                <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Height" Value="0"/>
                    <Setter Property="Visibility" Value="Collapsed"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- DataGrid Row Style for Dark Theme -->
        <Style TargetType="{x:Type DataGridRow}">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- DataGrid Cell Style for Dark Theme -->
        <Style TargetType="{x:Type DataGridCell}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Padding" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- DataGrid Style for Dark Theme with Rounded Corners -->
        <Style TargetType="{x:Type DataGrid}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="3"/>
        </Style>
        
        <!-- DataGrid Row Style with Rounded Corners -->
        <Style x:Key="RoundedDataGridRowStyle" TargetType="{x:Type DataGridRow}">
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridRow}">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                SnapsToDevicePixels="True"
                                Margin="0,0,0,0"
                                ClipToBounds="False">
                            <SelectiveScrollingGrid>
                                <SelectiveScrollingGrid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </SelectiveScrollingGrid.ColumnDefinitions>
                                <SelectiveScrollingGrid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </SelectiveScrollingGrid.RowDefinitions>
                                <DataGridRowHeader SelectiveScrollingGrid.SelectiveScrollingOrientation="Vertical" 
                                                   Visibility="Collapsed"/>
                                <DataGridCellsPresenter Grid.Column="1" 
                                                        ItemsPanel="{TemplateBinding ItemsPanel}"/>
                                <DataGridDetailsPresenter Grid.Row="1" Grid.Column="1" 
                                                          Visibility="{TemplateBinding DetailsVisibility}"/>
                            </SelectiveScrollingGrid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Global ListBox Style - fix borders and disable horizontal scrollbars -->
        <Style TargetType="{x:Type ListBox}">
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"/>
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
        </Style>
        
        <!-- Filter ListBox Style: force-disable horizontal scrollbars via template -->
        <Style x:Key="FilterListBoxStyle" TargetType="{x:Type ListBox}">
            <!-- Add proper dark theme colors -->
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.WindowTextBrushKey}}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBox">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="ScrollViewer"
                                          Focusable="false"
                                          HorizontalScrollBarVisibility="Disabled"
                                          VerticalScrollBarVisibility="Auto"
                                          CanContentScroll="True"
                                          IsDeferredScrollingEnabled="False">
                                <ScrollViewer.Template>
                                    <ControlTemplate TargetType="ScrollViewer">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <!-- Content presenter (no horizontal bar defined) -->
                                            <ScrollContentPresenter Grid.Column="0"
                                                                    CanContentScroll="{TemplateBinding CanContentScroll}"
                                                                    Content="{TemplateBinding Content}"
                                                                    ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                    SnapsToDevicePixels="True"
                                                                    Margin="0,0,0,0"/>
                                            <!-- Only vertical scrollbar -->
                                            <ScrollBar x:Name="PART_VerticalScrollBar"
                                                      Grid.Column="1"
                                                      Orientation="Vertical"
                                                      Value="{TemplateBinding VerticalOffset}"
                                                      Maximum="{TemplateBinding ScrollableHeight}"
                                                      ViewportSize="{TemplateBinding ViewportHeight}"
                                                      Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                                      Style="{StaticResource FilterScrollBarStyle}"/>
                                        </Grid>
                                    </ControlTemplate>
                                </ScrollViewer.Template>
                                <ItemsPresenter/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <!-- CRITICAL: Constrain item content to ListBox width so TextBlock can wrap -->
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>
        
        <!-- Dark Separator Style for Menu Bar -->
        <Style x:Key="DarkMenuSeparatorStyle" TargetType="{x:Type Separator}">
            <Setter Property="Background" Value="#3E3E42"/>
            <Setter Property="Height" Value="1"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <!-- Custom ScrollViewer with left-side scrollbar -->
        <Style x:Key="LeftScrollViewerStyle" TargetType="{x:Type ScrollViewer}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollViewer}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <ScrollBar x:Name="PART_VerticalScrollBar"
                                      Grid.Column="0"
                                      Orientation="Vertical"
                                      Value="{TemplateBinding VerticalOffset}"
                                      Maximum="{TemplateBinding ScrollableHeight}"
                                      ViewportSize="{TemplateBinding ViewportHeight}"
                                      Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                      Style="{StaticResource FilterScrollBarStyle}"
                                      HorizontalAlignment="Left"/>
                            <ScrollContentPresenter Grid.Column="1" 
                                                   Margin="{TemplateBinding Padding}"
                                                   Content="{TemplateBinding Content}"
                                                   ContentTemplate="{TemplateBinding ContentTemplate}"
                                                   CanContentScroll="{TemplateBinding CanContentScroll}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Title Bar Button Style -->
        <Style x:Key="TitleBarButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Title Bar Close Button Style (Red on Hover) -->
        <Style x:Key="TitleBarCloseButtonStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E81123"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#C50F1F"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Menu Style to remove border -->
        <Style TargetType="Menu">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
        </Style>
        
        <!-- MenuItem Style for vertical centering - inherits from DarkThemeMenuItemStyle -->
        <Style TargetType="MenuItem" BasedOn="{StaticResource DarkThemeMenuItemStyle}">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Height" Value="32"/>
        </Style>
        
        <!-- MenuButton Style - Top level menu button -->
        <Style x:Key="MenuButtonStyle" TargetType="MenuItem" BasedOn="{StaticResource DarkThemeMenuItemStyle}">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Height" Value="32"/>
        </Style>
    </Window.Resources>
    
    <DockPanel>
        <!-- Custom Title Bar with Menu -->
        <DockPanel DockPanel.Dock="Top" Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" Height="32">
            <!-- Window Controls (Minimize, Maximize, Close) -->
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" shell:WindowChrome.IsHitTestVisibleInChrome="True">
                <Button Content="â”€" Width="46" Height="32" 
                        Click="MinimizeWindow_Click"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTip="Minimize"/>
                <Button x:Name="MaximizeRestoreButton" Content="â–¡" Width="46" Height="32" 
                        Click="MaximizeRestoreWindow_Click"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTip="Maximize"/>
                <Button Content="âœ•" Width="46" Height="32" 
                        Click="CloseWindow_Click"
                        Style="{StaticResource TitleBarCloseButtonStyle}"
                        ToolTip="Close"/>
            </StackPanel>
            
            <!-- Launch Buttons -->
            <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" Margin="6,0,0,0" shell:WindowChrome.IsHitTestVisibleInChrome="True">
                <!-- Single Play Button (shown by default) -->
                <!-- Desktop Button (hidden by default) -->
                <Button x:Name="DesktopButton" 
                        Content="ðŸ–¥ï¸ Desktop"
                        Padding="8,4"
                        Click="LaunchDesktop_Click"
                        ToolTip="Launch VirtAMate in Desktop mode"
                        Margin="0,0,3,0"
                        Visibility="Collapsed">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                Padding="{TemplateBinding Padding}"
                                                CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="Visibility" Value="Visible">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                               From="0.0" To="1.0" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                
                <!-- Config Button (hidden by default) -->
                <Button x:Name="ConfigButton" 
                        Content="âš™ï¸ Custom"
                        Padding="8,4"
                        Click="LaunchConfig_Click"
                        ToolTip="Launch VirtAMate with screen selector"
                        Margin="0,0,3,0"
                        Visibility="Collapsed">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                Padding="{TemplateBinding Padding}"
                                                CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="Visibility" Value="Visible">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                               From="0.0" To="1.0" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                
                <!-- Cancel Button (hidden by default) -->
                <Button x:Name="CancelPlayButton" 
                        Content="âœ• Cancel"
                        Padding="8,4"
                        Click="CancelPlay_Click"
                        ToolTip="Cancel and return to main buttons"
                        Visibility="Collapsed">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{DynamicResource ButtonBackgroundBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                Padding="{TemplateBinding Padding}"
                                                CornerRadius="4">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="Visibility" Value="Visible">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                               From="0.0" To="1.0" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
            
            <!-- Menu Button on Left (App Title + Menu) -->
            <Menu Background="Transparent" DockPanel.Dock="Left" shell:WindowChrome.IsHitTestVisibleInChrome="True" VerticalAlignment="Center" Height="32" Padding="0">
            <MenuItem x:Name="MenuButton" Header="â˜° VPM v1.0.0" Style="{StaticResource MenuButtonStyle}">
                <!-- File Operations Section -->
                <MenuItem Header="ðŸ“‹ _File Operations">
                    <MenuItem Header="_Select Root Folder..." Click="SelectRootFolder_Click">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“" FontSize="12"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="_Refresh Packages" Click="RefreshPackages_Click">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ”„" FontSize="12"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="_Archive Old Versions..." Click="ArchiveOldVersions_Click">
                        <MenuItem.Icon>
                            <TextBlock Text="ðŸ“¦" FontSize="12"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <!-- Display Settings Section -->
                <Separator/>
                <MenuItem Header="ðŸŽ¨ _Display Settings">
                    <MenuItem Header="_Theme">
                        <MenuItem Header="ðŸŒ™ _Dark Theme" x:Name="DarkThemeMenuItem" Click="SetTheme_Click" Tag="Dark" IsChecked="True"/>
                        <MenuItem Header="â˜€ï¸ _Light Theme" x:Name="LightThemeMenuItem" Click="SetTheme_Click" Tag="Light"/>
                        <MenuItem Header="ðŸ–¥ï¸ _System Theme" x:Name="SystemThemeMenuItem" Click="SetTheme_Click" Tag="System"/>
                    </MenuItem>
                    <MenuItem Header="ðŸ“¦ _Hide Archived Packages">
                        <MenuItem Header="Enabled (default)" x:Name="HideArchivedEnabledMenuItem" Click="SetHideArchivedPackages_Click" Tag="True">
                            <MenuItem.Icon>
                                <Border Width="0"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Disabled" x:Name="HideArchivedDisabledMenuItem" Click="SetHideArchivedPackages_Click" Tag="False">
                            <MenuItem.Icon>
                                <Border Width="0"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                </MenuItem>
                
                <!-- Cache & Storage Section -->
                <Separator/>
                <MenuItem Header="ðŸ’¾ _Cache &amp; Storage">
                    <MenuItem Header="ðŸ“‚ Open Cache _Folder..." Click="OpenCacheFolder_Click"/>
                    <MenuItem Header="ðŸ—‘ï¸ Clear All _Metadata Cache" Click="ClearAllMetadataCache_Click"/>
                </MenuItem>
                
                <!-- Package Settings Section -->
                <Separator/>
                <MenuItem Header="ðŸ“¦ _Package Settings">
                    <MenuItem Header="ðŸ“¦ _File Size Ranges..." Click="ConfigureFileSizeRanges_Click"/>
                    <MenuItem Header="ðŸ“Š _Preview Selection Limit">
                        <MenuItem Header="100 packages" Click="SetMaxSafeSelection_Click" Tag="100"/>
                        <MenuItem Header="200 packages (default)" Click="SetMaxSafeSelection_Click" Tag="200"/>
                        <MenuItem Header="500 packages" Click="SetMaxSafeSelection_Click" Tag="500"/>
                        <MenuItem Header="1000 packages" Click="SetMaxSafeSelection_Click" Tag="1000"/>
                    </MenuItem>
                </MenuItem>
                
                <!-- Tools Section -->
                <Separator/>
                <MenuItem Header="ðŸ› ï¸ _Tools">
                    <MenuItem x:Name="PackageDownloadsToolbarButton" 
                              Header="ðŸ“¥ Package Downloads" 
                              Click="PackageDownloadsToolbar_Click"
                              ToolTip="Search and download missing packages"/>
                    <MenuItem x:Name="CheckUpdatesToolbarButton" 
                              Header="ðŸ“¡ Check for Updates" 
                              Click="CheckUpdatesToolbar_Click"
                              ToolTip="Check for package updates"/>
                    <MenuItem x:Name="DownloadMissingToolbarButton" 
                              Header="ðŸ“¥ Download Missing" 
                              Click="DownloadMissingToolbar_Click"
                              ToolTip="Download missing dependencies"
                              Visibility="Collapsed"/>
                </MenuItem>
                
                <!-- Help Section -->
                <Separator/>
                <MenuItem Header="â“ _Help">
                    <MenuItem Header="âŒ¨ï¸ _Keyboard Shortcuts" Click="KeyboardShortcuts_Click"/>
                    <MenuItem Header="_About VPM" Click="About_Click"/>
                </MenuItem>
                
                <!-- Exit at Bottom -->
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Status Text (in same row as menu) -->
        <TextBlock x:Name="StatusText" 
                   DockPanel.Dock="Left"
                   Text="Ready" 
                   VerticalAlignment="Center" 
                   Margin="12,0,12,0"
                   FontSize="14"
                   FontWeight="SemiBold"
                   Foreground="{DynamicResource {x:Static SystemColors.MenuTextBrushKey}}"/>
        
        <!-- Draggable Title Area (fills remaining space) -->
        <Border DockPanel.Dock="Left" 
                MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                shell:WindowChrome.IsHitTestVisibleInChrome="False"
                Cursor="Hand"
                Background="Transparent"/>
        </DockPanel>
        
        <!-- Main Content -->
        <Grid Margin="3">
        <Grid.ColumnDefinitions>
            <!-- Left Panel: Filters -->
            <ColumnDefinition Width="0.75*" MinWidth="150" x:Name="LeftPanelColumn"/>
            <ColumnDefinition Width="5"/>
            <!-- Main Table: Largest panel -->
            <ColumnDefinition Width="1.52*" MinWidth="300" x:Name="CenterPanelColumn"/>
            <ColumnDefinition Width="5"/>
            <!-- Dependencies Panel -->
            <ColumnDefinition Width="1.3*" MinWidth="200" x:Name="RightPanelColumn"/>
            <ColumnDefinition Width="5"/>
            <!-- Images Panel -->
            <ColumnDefinition Width="1.48*" MinWidth="150" x:Name="ImagesPanelColumn"/>
        </Grid.ColumnDefinitions>
        
        <!-- Left Panel - Filters -->
        <Border Grid.Column="0" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" 
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                BorderThickness="1" CornerRadius="{StaticResource CornerRadiusValue}"
                Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Static Button Area at Top -->
                <Grid Grid.Row="0" Margin="6,6,6,6" PreviewMouseWheel="FilterArea_PreviewMouseWheel">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Content Mode Switch Dropdown -->
                    <ComboBox x:Name="ContentModeDropdown"
                              Grid.Column="0"
                              Height="{StaticResource LinkedButtonHeight}"
                              Padding="6,6"
                              SelectionChanged="ContentModeDropdown_SelectionChanged"
                              ToolTip="Select between Packages, Scenes, and Presets mode"
                              Margin="0,0,6,0"
                              HorizontalAlignment="Stretch"
                              VerticalContentAlignment="Center"
                              Background="#2d2d2d"
                              Foreground="White"
                              BorderBrush="#404040"
                              BorderThickness="1">
                        <ComboBox.Template>
                            <ControlTemplate TargetType="ComboBox">
                                <Grid>
                                    <ToggleButton Grid.Column="0"
                                                  Name="ToggleButton"
                                                  Grid.ColumnSpan="2"
                                                  Focusable="false"
                                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                  ClickMode="Press"
                                                  Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                                                  Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"
                                                  BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                                                  BorderThickness="1">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                                        <Setter Property="BorderThickness" Value="1"/>
                                                    </Trigger>
                                                    <Trigger Property="IsPressed" Value="True">
                                                        <Setter Property="Background" Value="#007ACC"/>
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </Trigger>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                                        <Setter Property="BorderThickness" Value="1"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <TextBlock Text="Mode" VerticalAlignment="Center" Foreground="{TemplateBinding Foreground}"/>
                                            <TextBlock Text="â–¼" FontSize="10" VerticalAlignment="Center" Foreground="{TemplateBinding Foreground}" Margin="6,0,0,0"/>
                                        </StackPanel>
                                    </ToggleButton>
                                    <ContentPresenter Name="ContentPresenter"
                                                      IsHitTestVisible="false"
                                                      Content="{TemplateBinding SelectionBoxItem}"
                                                      ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                      ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                      Margin="3,3,23,3"
                                                      VerticalAlignment="Center"
                                                      HorizontalAlignment="Left"
                                                      Visibility="Collapsed"/>
                                    <Popup Name="Popup"
                                           Placement="Bottom"
                                           IsOpen="{TemplateBinding IsDropDownOpen}"
                                           AllowsTransparency="True"
                                           Focusable="False"
                                           PopupAnimation="Slide">
                                        <Grid Name="DropDown"
                                              SnapsToDevicePixels="True"
                                              MinWidth="{TemplateBinding ActualWidth}"
                                              MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                            <Border x:Name="DropDownBorder"
                                                    Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                                                    BorderThickness="1"
                                                    BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                                                    CornerRadius="4">
                                                <ScrollViewer SnapsToDevicePixels="True">
                                                    <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
                                                </ScrollViewer>
                                            </Border>
                                        </Grid>
                                    </Popup>
                                </Grid>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="HasItems" Value="false">
                                        <Setter TargetName="DropDownBorder" Property="MinHeight" Value="95"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </ComboBox.Template>
                        <ComboBoxItem Content="ðŸ“¦ Packages"/>
                        <ComboBoxItem Content="ðŸŽ¬ Scenes"/>
                        <ComboBoxItem Content="ðŸŽ¨ Presets"/>
                    </ComboBox>
                    
                    <!-- Linked Filters Button (Icon + Status) -->
                    <Button x:Name="LinkedFiltersButton"
                            Grid.Column="1"
                            Height="{StaticResource LinkedButtonHeight}"
                            Padding="6,6"
                            Click="ToggleLinkedFilters_Click"
                            ToolTip="On: Multiple selections, all options visible
Off: Single selection, hide incompatible options"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Margin="0,0,6,0">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="ðŸ“¦ " FontSize="15" VerticalAlignment="Center"/>
                            <TextBlock x:Name="LinkedStatusText" Text="Off" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Refresh Button -->
                    <Button x:Name="RefreshPackagesButton"
                            Grid.Column="2"
                            Content="ðŸ”„"
                            Height="{StaticResource LinkedButtonHeight}"
                            Width="{StaticResource LinkedButtonHeight}"
                            Padding="0"
                            FontSize="15"
                            Click="RefreshPackagesButton_Click"
                            ToolTip="Refresh package list"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Margin="0,0,0,0"/>
                </Grid>
                
                <!-- Scrollable Filter Area -->
                <ScrollViewer x:Name="FilterScrollViewer"
                             Grid.Row="1" 
                             VerticalScrollBarVisibility="Hidden" 
                             HorizontalScrollBarVisibility="Disabled" 
                             PanningMode="VerticalOnly"
                             Padding="0">
                    <StackPanel x:Name="FilterGrid" Margin="9,0,9,9">
                    
                    <!-- Package Filters Container (Hidden in Scene Mode) -->
                    <StackPanel x:Name="PackageFiltersContainer">
                    
                    <!-- Date Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <!-- Collapsed state (shown when hidden) -->
                        <Grid x:Name="DateFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="DateFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="DateFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="DateFilterToggleButtonCollapsed" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="DateFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="DateFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="DateFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“… Filter by Date"/>
                        </Grid>
                        
                        <!-- Expanded state (shown when visible) -->
                        <Grid x:Name="DateFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="DateFilterToggleButton" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="DateFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="ðŸ“… Filter by Date"/>
                        </Grid>
                        
                        <ListBox x:Name="DateFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding DateFilterHeight, Mode=TwoWay}" 
                                 MinHeight="60" MaxHeight="200"
                                 SelectionMode="Single" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="DateFilterList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="3"/>
                            <Setter Property="Margin" Value="0,3,0,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FF3D3D3D"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#FF4A4A4A"/>
                                    <Setter Property="Foreground" Value="#FFFFFFFF"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- Date filter items will be populated dynamically with package counts -->
                        </ListBox>
                        
                        <!-- Custom Date Range Panel (Initially Hidden) -->
                        <StackPanel x:Name="CustomDateRangePanel" Margin="0,6,0,0" Visibility="Collapsed">
                            <Label Content="From:" FontSize="12" Margin="0,6,0,3"/>
                            <DatePicker x:Name="StartDatePicker" Margin="0,0,0,6" 
                                        SelectedDateChanged="CustomDateRange_Changed"/>
                            <Label Content="To:" FontSize="12" Margin="0,6,0,3"/>
                            <DatePicker x:Name="EndDatePicker" Margin="0,0,0,6"
                                        SelectedDateChanged="CustomDateRange_Changed"/>
                            <Button x:Name="ApplyCustomDateButton" Content="Apply Range" 
                                    Margin="0,6,0,0" Padding="9,3"
                                    Click="ApplyCustomDateRange_Click"
                                    Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                                    BorderThickness="1"
                                    BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Status Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <!-- Collapsed state (shown when hidden) -->
                        <Grid x:Name="StatusFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="StatusFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="StatusFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="StatusFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="StatusFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="StatusFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="StatusFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“Š Filter by Status"/>
                        </Grid>
                        
                        <!-- Expanded state (shown when visible) -->
                        <Grid x:Name="StatusFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="StatusFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="StatusFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="ðŸ“Š Filter by Status"/>
                            <Button x:Name="StatusSortButton" Grid.Column="2" 
                            Content="â‡…" 
                            Padding="0" FontSize="12" FontWeight="Bold"
                            Click="StatusSortButton_Click"
                            ToolTip="Sort status filters alphabetically"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="{StaticResource FilterToggleButtonSize}" 
                            Height="{StaticResource FilterToggleButtonSize}"/>
                        </Grid>
                        
                        <ListBox x:Name="StatusFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding StatusFilterHeight, Mode=TwoWay}" 
                                 MinHeight="80" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="StatusFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="3"/>
                            <Setter Property="Margin" Value="0,3,0,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FF3D3D3D"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#FF4A4A4A"/>
                                    <Setter Property="Foreground" Value="#FFFFFFFF"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- Status items will be populated dynamically -->
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Content Types Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="ContentTypesFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="ContentTypesFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="ContentTypesFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="ContentTypesFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="ContentTypesFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="ContentTypesFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="ContentTypesFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" 
                                   Content="ðŸ“¦ Filter content types"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="ContentTypesFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="ContentTypesFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=ContentTypesFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="ContentTypesFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="ContentTypesFilterBox" Grid.Column="1"
                             Text="ðŸ“¦ Filter content types..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="ContentTypesFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="ContentTypesClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=ContentTypesFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="ContentTypesSortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="ContentTypesSortButton_Click"
                            ToolTip="Sort content types alphabetically"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=ContentTypesFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="ContentTypesList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding ContentTypesFilterHeight, Mode=TwoWay}" 
                                 MinHeight="120" MaxHeight="250"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="ContentTypesList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="3"/>
                            <Setter Property="Margin" Value="0,3,0,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FF3D3D3D"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#FF4A4A4A"/>
                                    <Setter Property="Foreground" Value="#FFFFFFFF"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- Content types will be populated dynamically -->
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Creators Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="CreatorsFilterCollapsedGrid" Margin="0,0,0,5" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="CreatorsFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="CreatorsFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="CreatorsFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="CreatorsFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="CreatorsFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="CreatorsFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" 
                                   Content="ðŸ‘¤ Filter creators"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="CreatorsFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="CreatorsFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=CreatorsFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="CreatorsFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="CreatorsFilterBox" Grid.Column="1"
                             Text="ðŸ‘¤ Filter creators..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="CreatorsFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="CreatorsClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=CreatorsFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="CreatorsSortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="CreatorsSortButton_Click"
                            ToolTip="Sort creators"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=CreatorsFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="CreatorsList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding CreatorsFilterHeight, Mode=TwoWay}" 
                                 MinHeight="120" MaxHeight="250"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="CreatorsList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="3"/>
                            <Setter Property="Margin" Value="0,3,0,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- Creators will be populated dynamically -->
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Subfolders Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <!-- Collapsed state (shown when hidden) -->
                        <Grid x:Name="SubfoldersFilterCollapsedGrid" Margin="0,0,0,5" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SubfoldersFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="SubfoldersFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SubfoldersFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SubfoldersFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SubfoldersFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="SubfoldersFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“ Filter by subfolders"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="SubfoldersFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SubfoldersFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=SubfoldersFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SubfoldersFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="SubfoldersFilterBox" Grid.Column="1"
                             Text="ðŸ“ Filter subfolders..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="SubfoldersFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="SubfoldersClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=SubfoldersFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="SubfoldersSortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="SubfoldersSortButton_Click"
                            ToolTip="Sort subfolders alphabetically"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=SubfoldersFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="SubfoldersFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding SubfoldersFilterHeight, Mode=TwoWay}" 
                                 MinHeight="100" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="SubfoldersFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- Subfolders will be populated dynamically -->
                        </ListBox>
                    </StackPanel>
                    
                    <!-- License Type Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="LicenseTypeFilterCollapsedGrid" Margin="0,0,0,5" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="LicenseTypeFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="LicenseTypeFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="LicenseTypeFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="LicenseTypeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="LicenseTypeFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="LicenseTypeFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" 
                                   Content="âš–ï¸ Filter license types"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="LicenseTypeFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="LicenseTypeFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=LicenseTypeFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="LicenseTypeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="LicenseTypeFilterBox" Grid.Column="1"
                             Text="âš–ï¸ Filter license types..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="LicenseTypeFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="LicenseTypeClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=LicenseTypeFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="LicenseTypeSortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="LicenseTypeSortButton_Click"
                            ToolTip="Sort license types"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=LicenseTypeFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="LicenseTypeList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding LicenseTypeFilterHeight, Mode=TwoWay}" 
                                 MinHeight="100" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="LicenseTypeList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- License types will be populated dynamically -->
                        </ListBox>
                    </StackPanel>
                    
                    <!-- File Size Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <!-- Collapsed state (shown when hidden) -->
                        <Grid x:Name="FileSizeFilterCollapsedGrid" Margin="0,0,0,5" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="FileSizeFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="FileSizeFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="FileSizeFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="FileSizeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="FileSizeFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="FileSizeFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“¦ Filter by size"/>
                        </Grid>
                        
                        <!-- Expanded state (shown when visible) -->
                        <Grid x:Name="FileSizeFilterExpandedGrid" Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="FileSizeFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="FileSizeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="ðŸ“¦ Filter by size"/>
                        </Grid>
                        
                        <ListBox x:Name="FileSizeFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding FileSizeFilterHeight, Mode=TwoWay}" 
                                 MinHeight="100" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="FileSizeFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- File size ranges will be populated dynamically -->
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Damaged Packages Filter Section -->
                    <StackPanel Margin="0,6,0,0">
                        <Grid x:Name="DamagedFilterCollapsedGrid" Margin="0,0,0,5" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="DamagedFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="DamagedFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="DamagedFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="DamagedFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="DamagedFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="DamagedFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="âš ï¸ Filter damaged packages"/>
                        </Grid>
                        
                        <Grid x:Name="DamagedFilterExpandedGrid" Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="DamagedFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="DamagedFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="âš ï¸ Filter damaged packages"/>
                        </Grid>
                        
                        <ListBox x:Name="DamagedFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="{Binding DamagedFilterHeight, Mode=TwoWay}" 
                                 MinHeight="60" MaxHeight="120"
                                 SelectionMode="Single" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="DamagedFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                            <!-- Damaged packages will be populated dynamically -->
                        </ListBox>
                    </StackPanel>
                    
                    </StackPanel>
                    
                    <!-- Scene Filters Container (Scene Mode Only) -->
                    <StackPanel x:Name="SceneFiltersContainer" Visibility="Collapsed">
                    
                    <!-- Scene Type Filter Section (Scene Mode Only) -->
                    <StackPanel x:Name="SceneTypeFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="SceneTypeFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneTypeFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="SceneTypeFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneTypeFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneTypeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneTypeFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="SceneTypeFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸŽ¬ Filter scene types"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="SceneTypeFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneTypeFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=SceneTypeFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneTypeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="SceneTypeFilterBox" Grid.Column="1"
                             Text="ðŸŽ¬ Filter scene types..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="SceneTypeFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="SceneTypeClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=SceneTypeFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="SceneTypeSortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="SceneTypeSortButton_Click"
                            ToolTip="Sort scene types alphabetically"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=SceneTypeFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="SceneTypeFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="80" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="SceneTypeFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Scene Creator Filter Section (Scene Mode Only) -->
                    <StackPanel x:Name="SceneCreatorFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="SceneCreatorFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneCreatorFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="SceneCreatorFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneCreatorFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneCreatorFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneCreatorFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="SceneCreatorFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ‘¤ Filter scene creators"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="SceneCreatorFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneCreatorFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=SceneCreatorFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneCreatorFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="SceneCreatorFilterBox" Grid.Column="1"
                             Text="ðŸ‘¤ Filter scene creators..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="SceneCreatorFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="SceneCreatorClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=SceneCreatorFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="SceneCreatorSortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="SceneCreatorSortButton_Click"
                            ToolTip="Sort scene creators"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=SceneCreatorFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="SceneCreatorFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="80" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="SceneCreatorFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Scene Status Filter Section -->
                    <StackPanel x:Name="SceneStatusFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <Grid x:Name="SceneStatusFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneStatusFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="SceneStatusFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneStatusFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneStatusFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneStatusFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="SceneStatusFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="â¤ï¸ Filter by status"/>
                        </Grid>
                        
                        <Grid x:Name="SceneStatusFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneStatusFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneStatusFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="â¤ï¸ Filter by status"/>
                        </Grid>
                        
                        <ListBox x:Name="SceneStatusFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="60" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="SceneStatusFilterList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Scene Source Filter Section (Scene Mode Only) -->
                    <StackPanel x:Name="SceneSourceFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="SceneSourceFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneSourceFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="SceneSourceFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneSourceFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneSourceFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneSourceFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="SceneSourceFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="âœ— Filter scene source"/>
                        </Grid>
                        
                        <!-- Expanded state (shown when visible) -->
                        <Grid x:Name="SceneSourceFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneSourceFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneSourceFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="âœ— Filter scene source"/>
                        </Grid>
                        
                        <ListBox x:Name="SceneSourceFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="80" 
                                 MinHeight="60" MaxHeight="120"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="SceneSourceFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Scene Date Filter Section -->
                    <StackPanel x:Name="SceneDateFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <Grid x:Name="SceneDateFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneDateFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="SceneDateFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneDateFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneDateFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneDateFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="SceneDateFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“… Filter by date"/>
                        </Grid>
                        
                        <Grid x:Name="SceneDateFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneDateFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneDateFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="ðŸ“… Filter by date"/>
                        </Grid>
                        
                        <ListBox x:Name="SceneDateFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="60" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="SceneDateFilterList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Scene File Size Filter Section -->
                    <StackPanel x:Name="SceneFileSizeFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <Grid x:Name="SceneFileSizeFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneFileSizeFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="SceneFileSizeFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneFileSizeFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneFileSizeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="SceneFileSizeFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="SceneFileSizeFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ’¾ Filter by file size"/>
                        </Grid>
                        
                        <Grid x:Name="SceneFileSizeFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="SceneFileSizeFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="SceneFileSizeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="ðŸ’¾ Filter by file size"/>
                        </Grid>
                        
                        <ListBox x:Name="SceneFileSizeFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="60" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="SceneFileSizeFilterList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    </StackPanel>
                    
                    <!-- Preset Filters Container (Presets Mode Only) -->
                    <StackPanel x:Name="PresetFiltersContainer" Visibility="Collapsed">
                    
                    <!-- Preset Category Filter Section -->
                    <StackPanel x:Name="PresetCategoryFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="PresetCategoryFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetCategoryFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="PresetCategoryFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetCategoryFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetCategoryFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetCategoryFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="PresetCategoryFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“‚ Filter by category"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="PresetCategoryFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetCategoryFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=PresetCategoryFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetCategoryFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="PresetCategoryFilterBox" Grid.Column="1"
                             Text="ðŸŽ¬ Filter by category..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="PresetCategoryFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="PresetCategoryClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=PresetCategoryFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="PresetCategorySortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="PresetCategorySortButton_Click"
                            ToolTip="Sort categories alphabetically"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=PresetCategoryFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="PresetCategoryFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="80" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="PresetCategoryFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Preset Subfolder Filter Section -->
                    <StackPanel x:Name="PresetSubfolderFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <!-- Collapsed state label (shown when hidden) -->
                        <Grid x:Name="PresetSubfolderFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetSubfolderFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="PresetSubfolderFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetSubfolderFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetSubfolderFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetSubfolderFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="PresetSubfolderFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“ Filter by subfolder"/>
                        </Grid>
                        
                        <!-- TextBox Grid with eye button (shown when expanded) -->
                        <Grid x:Name="PresetSubfolderFilterTextBoxGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*" MinWidth="110"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetSubfolderFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="27"
                                    Height="{Binding ElementName=PresetSubfolderFilterBox, Path=ActualHeight}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetSubfolderFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <TextBox x:Name="PresetSubfolderFilterBox" Grid.Column="1"
                             Text="ðŸ“ Filter by subfolder..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="PresetSubfolderFilterBox_TextChanged"
                             MinWidth="110"/>
                            <Button x:Name="PresetSubfolderClearButton" Grid.Column="2" 
                            Content="âœ•" 
                            Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=PresetSubfolderFilterBox, Path=ActualHeight}"/>
                            <Button x:Name="PresetSubfolderSortButton" Grid.Column="3" 
                            Content="â‡…" 
                            Margin="3,0,0,0" Padding="0" FontSize="12" FontWeight="Bold"
                            Click="PresetSubfolderSortButton_Click"
                            ToolTip="Sort subfolders alphabetically"
                            Style="{StaticResource BlueHoverButtonStyle}"
                            Width="27"
                            Height="{Binding ElementName=PresetSubfolderFilterBox, Path=ActualHeight}"/>
                        </Grid>
                        
                        <ListBox x:Name="PresetSubfolderFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="80" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="PresetSubfolderFilterList_SelectionChanged"
                                 MouseLeftButtonDown="FilterList_MouseLeftButtonDown">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Preset Status Filter Section -->
                    <StackPanel x:Name="PresetStatusFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <Grid x:Name="PresetStatusFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetStatusFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="PresetStatusFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetStatusFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetStatusFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetStatusFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="PresetStatusFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="â¤ï¸ Filter by status"/>
                        </Grid>
                        
                        <Grid x:Name="PresetStatusFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetStatusFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetStatusFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="â¤ï¸ Filter by status"/>
                        </Grid>
                        
                        <ListBox x:Name="PresetStatusFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="60" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="PresetStatusFilterList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Preset Date Filter Section -->
                    <StackPanel x:Name="PresetDateFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <Grid x:Name="PresetDateFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetDateFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="PresetDateFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetDateFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetDateFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetDateFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="PresetDateFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ“… Filter by date"/>
                        </Grid>
                        
                        <Grid x:Name="PresetDateFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetDateFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetDateFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="ðŸ“… Filter by date"/>
                        </Grid>
                        
                        <ListBox x:Name="PresetDateFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="60" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="PresetDateFilterList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    <!-- Preset File Size Filter Section -->
                    <StackPanel x:Name="PresetFileSizeFilterSection" Margin="0,6,0,0" Visibility="Collapsed">
                        <Grid x:Name="PresetFileSizeFilterCollapsedGrid" Margin="0,0,0,6" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetFileSizeFilterMoveUpButton" Grid.Column="0"
                                    Content="â–²" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveUp_Click"
                                    Tag="PresetFileSizeFilter"
                                    ToolTip="Move filter up"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetFileSizeFilterToggleButton" Grid.Column="1"
                                    Content="ðŸ‘ï¸â€ðŸ—¨ï¸" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,3,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetFileSizeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Button x:Name="PresetFileSizeFilterMoveDownButton" Grid.Column="2"
                                    Content="â–¼" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="12" FontWeight="Bold"
                                    Click="FilterMoveDown_Click"
                                    Tag="PresetFileSizeFilter"
                                    ToolTip="Move filter down"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="3" Content="ðŸ’¾ Filter by file size"/>
                        </Grid>
                        
                        <Grid x:Name="PresetFileSizeFilterExpandedGrid" Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="PresetFileSizeFilterToggleButtonExpanded" Grid.Column="0"
                                    Content="ðŸ‘" 
                                    Width="{StaticResource FilterToggleButtonSize}" 
                                    Height="{StaticResource FilterToggleButtonSize}"
                                    Margin="0,0,6,0"
                                    Padding="0" FontSize="15"
                                    Click="ToggleFilterVisibility_Click"
                                    Tag="PresetFileSizeFilter"
                                    ToolTip="Toggle filter section visibility"
                                    Style="{StaticResource BlueHoverButtonStyle}"/>
                            <Label Grid.Column="1" Content="ðŸ’¾ Filter by file size"/>
                        </Grid>
                        
                        <ListBox x:Name="PresetFileSizeFilterList"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.IsDeferredScrollingEnabled="True" 
                                 Height="120" 
                                 MinHeight="60" MaxHeight="200"
                                 SelectionMode="Multiple" BorderThickness="1"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.CanContentScroll="True"
                                 Style="{StaticResource FilterListBoxStyle}"
                                 SelectionChanged="PresetFileSizeFilterList_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Margin="6,0,0,0"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF6200EA"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                        </ListBox>
                    </StackPanel>
                    
                    </StackPanel>
                    
                    </StackPanel>
                </ScrollViewer>
                
                <!-- Compact Scroll Here Area -->
                <Border x:Name="ScrollHereArea"
                        Grid.Row="2"
                        Height="28"
                        Background="Transparent"
                        BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
                        BorderThickness="0,1,0,0"
                        Margin="8,0,8,4"
                        PreviewMouseWheel="ScrollHereArea_PreviewMouseWheel"
                        Cursor="ScrollNS">
                    <TextBlock Text="Scroll here or at top button area"
                               FontSize="11"
                               Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Opacity="0.8"/>
                </Border>
            </Grid>
        </Border>
        
        <!-- Splitter -->
        <GridSplitter Grid.Column="1" Width="2" HorizontalAlignment="Stretch" 
                      Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
        
        <!-- Center Panel - Packages/Scenes -->
        <Border Grid.Column="2" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" 
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                BorderThickness="1" CornerRadius="6">
            <Grid Margin="6,6,0,6">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Package/Scene Search -->
                <Grid Grid.Row="0" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Package Action Tabs -->
                    <Grid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button Name="FavoriteToggleButton" Grid.Column="0"
                                Click="FavoriteToggleButton_Click"
                                PreviewMouseRightButtonDown="FavoriteToggleButton_PreviewMouseRightButtonDown"
                                ToolTip="Left-click: Add to favorites | Right-click: Remove from favorites | Ctrl+click: Open Favorites.txt"
                                Padding="6"
                                FontSize="12"
                                Margin="0,0,3,0"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="â¤ï¸ " FontSize="13" FontWeight="Bold" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" VerticalAlignment="Center"/>
                                    <TextBlock Text="Favorite" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button.Content>
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button Name="AutoInstallToggleButton" Grid.Column="1"
                                Click="AutoInstallToggleButton_Click"
                                PreviewMouseRightButtonDown="AutoInstallToggleButton_PreviewMouseRightButtonDown"
                                ToolTip="Left-click: Add to autoinstall | Right-click: Remove from autoinstall | Ctrl+click: Open AutoInstall.txt"
                                Padding="3,3"
                                FontSize="12"
                                Margin="3,0,3,0"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="A " FontSize="14" FontWeight="Bold" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" VerticalAlignment="Center"/>
                                    <TextBlock Text="AutoInstall" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button.Content>
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button Name="HideToggleButton" Grid.Column="1"
                                Click="HideToggleButton_Click"
                                PreviewMouseRightButtonDown="HideToggleButton_PreviewMouseRightButtonDown"
                                ToolTip="Left-click: Hide selected scenes | Right-click: Unhide selected scenes"
                                Padding="3,3"
                                FontSize="12"
                                Margin="3,0,3,0"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Visibility="Collapsed">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ™ˆ " FontSize="14" FontWeight="Bold" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" VerticalAlignment="Center"/>
                                    <TextBlock Text="Hide" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button.Content>
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button Name="OptimizeToggleButton" Grid.Column="2"
                                Click="OptimizeToggleButton_Click"
                                ToolTip="Optimize selected packages"
                                Padding="10,6"
                                FontSize="12"
                                Margin="3,0,0,0"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âš¡ " FontSize="14" FontWeight="Bold" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" VerticalAlignment="Center"/>
                                    <TextBlock Text="Optimize" VerticalAlignment="Center"/>
                                    <TextBlock Name="OptimizeCountText" Text="" FontSize="11" FontWeight="Bold" Foreground="#FFA500" VerticalAlignment="Center" Margin="4,0,0,0"/>
                                </StackPanel>
                            </Button.Content>
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                    
                    <TextBox Name="PackageSearchBox" Grid.Row="1" Grid.Column="0" Margin="0,6,0,0"
                             Text="ðŸ“¦ Filter packages, descriptions, tags..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="PackageSearchBox_TextChanged"/>
                    <Button Name="PackageSearchClearButton" Grid.Row="1" Grid.Column="1" 
                            Content="âœ•" 
                            Margin="3,6,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            VerticalAlignment="Center"
                            MinWidth="30">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                <Setter Property="Width" Value="{Binding ElementName=PackageSearchBox, Path=ActualHeight}"/>
                                <Setter Property="Height" Value="{Binding ElementName=PackageSearchBox, Path=ActualHeight}"/>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Button Name="PackageSortButton" Grid.Row="1" Grid.Column="2" 
                            Content="â‡…" 
                            Margin="2,6,0,0" Padding="0" FontSize="14" FontWeight="Bold"
                            Click="PackageSortButton_Click"
                            MouseWheel="PackageSortButton_MouseWheel"
                            ToolTip="Sort packages (Scroll to navigate)"
                            VerticalAlignment="Center"
                            MinWidth="30">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                <Setter Property="Width" Value="{Binding ElementName=PackageSearchBox, Path=ActualHeight}"/>
                                <Setter Property="Height" Value="{Binding ElementName=PackageSearchBox, Path=ActualHeight}"/>
                            </Style>
                        </Button.Style>
                    </Button>
                    
                    <!-- Scene Search Box (hidden by default) -->
                    <TextBox Name="SceneSearchBox" Grid.Row="1" Grid.Column="0" Margin="0,6,0,0"
                             Text="ðŸ“ Filter scenes by name, creator, type..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="SceneSearchBox_TextChanged"
                             Visibility="Collapsed"/>
                    <Button Name="SceneSearchClearButton" Grid.Row="1" Grid.Column="1" 
                            Content="âœ•" 
                            Margin="3,6,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearSceneFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            VerticalAlignment="Center"
                            MinWidth="30">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                <Setter Property="Width" Value="{Binding ElementName=SceneSearchBox, Path=ActualHeight}"/>
                                <Setter Property="Height" Value="{Binding ElementName=SceneSearchBox, Path=ActualHeight}"/>
                            </Style>
                        </Button.Style>
                    </Button>
                    
                    <!-- Presets Search Box (hidden by default) -->
                    <TextBox Name="CustomAtomSearchBox" Grid.Row="1" Grid.Column="0" Margin="0,6,0,0"
                             Text="ðŸ” Filter presets by name..." 
                             Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                             Padding="5"
                             GotFocus="FilterTextBox_GotFocus" 
                             LostFocus="FilterTextBox_LostFocus"
                             TextChanged="CustomAtomSearchBox_TextChanged"
                             Visibility="Collapsed"/>
                    <Button Name="CustomAtomSearchClearButton" Grid.Row="1" Grid.Column="1" 
                            Content="âœ•" 
                            Margin="3,6,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                            Click="ClearCustomAtomFilterButton_Click"
                            ToolTip="Clear filter"
                            Visibility="Collapsed"
                            VerticalAlignment="Center"
                            MinWidth="30">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                <Setter Property="Width" Value="{Binding ElementName=CustomAtomSearchBox, Path=ActualHeight}"/>
                                <Setter Property="Height" Value="{Binding ElementName=CustomAtomSearchBox, Path=ActualHeight}"/>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
                
                <!-- Package List -->
                <DataGrid x:Name="PackageDataGrid" Grid.Row="1" BorderThickness="1" SelectionMode="Extended"
                          ItemsSource="{Binding Source={StaticResource PackagesView}}"
                          SelectionChanged="PackageDataGrid_SelectionChanged"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          VirtualizingPanel.CacheLength="100,100"
                          VirtualizingPanel.CacheLengthUnit="Item"
                          VirtualizingPanel.ScrollUnit="Item"
                          VirtualizingPanel.IsContainerVirtualizable="True"
                          ScrollViewer.CanContentScroll="True"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="False"
                          ScrollViewer.IsDeferredScrollingEnabled="False"
                          IsManipulationEnabled="False"
                                    AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="True"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          IsReadOnly="True"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="None"
                          RowHeaderWidth="0"
                          RowHeight="65"
                          Background="Transparent"
                          Margin="0,0,0,0"
                          FontSize="12"
                          RowStyle="{StaticResource RoundedDataGridRowStyle}">
                    <DataGrid.Resources>
                        <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource DataGridScrollBarStyle}"/>
                    </DataGrid.Resources>
                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                            <Setter Property="BorderThickness" Value="0,0,1,1"/>
                            <Setter Property="Padding" Value="8,6"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>
                    <DataGrid.Columns>
                        <!-- Status Column with Colored Bubbles -->
                        <DataGridTemplateColumn Header="Status" Width="48" CanUserResize="False" CanUserReorder="False" CanUserSort="True" SortMemberPath="Status">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Ellipse Width="12" Height="12" 
                                             Fill="{Binding StatusColor, Converter={x:Static local:ColorToBrushConverter.Instance}}"
                                             HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <!-- Package Name Column with metadata in second row -->
                        <DataGridTemplateColumn Header="Package Name" Width="*" CanUserSort="True" SortMemberPath="DisplayName">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="4,2" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" TextTrimming="CharacterEllipsis"/>
                                        <StackPanel Orientation="Horizontal">
                                            <!-- Favorite star -->
                                            <TextBlock FontSize="12" FontWeight="Bold" Foreground="#FF1493" Text="â¤ï¸" Margin="0,0,0,0"
                                                       Visibility="{Binding IsFavorite, Converter={StaticResource BoolToVis}}"
                                                       ToolTip="Favorite package"
                                                       RenderTransformOrigin="0,0.6">
                                                <TextBlock.RenderTransform>
                                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                                </TextBlock.RenderTransform>
                                            </TextBlock>
                                            
                                            <!-- AutoInstall A icon -->
                                            <TextBlock FontSize="12" FontWeight="Bold" Foreground="#FFA500" Text=" A" Margin="2,0,2,0"
                                                       Visibility="{Binding IsAutoInstall, Converter={StaticResource BoolToVis}}"
                                                       ToolTip="AutoInstall package"
                                                       RenderTransformOrigin="0,0.6">
                                                <TextBlock.RenderTransform>
                                                    <ScaleTransform ScaleX="1.3" ScaleY="1.3"/>
                                                </TextBlock.RenderTransform>
                                            </TextBlock>
                                            
                                            <!-- Optimized lightning bolt -->
                                            <TextBlock FontSize="12" FontWeight="Bold" Foreground="#FFC107" Text="âš¡" Margin="2,0,2,0"
                                                       Visibility="{Binding IsOptimized, Converter={StaticResource BoolToVis}}"
                                                       ToolTip="Package has been optimized by VPM"
                                                       RenderTransformOrigin="0.5,0.8">
                                                <TextBlock.RenderTransform>
                                                    <ScaleTransform ScaleX="1.2" ScaleY="1.2"/>
                                                </TextBlock.RenderTransform>
                                            </TextBlock>
                                            
                                            <!-- Old Version indicator -->
                                            <TextBlock FontSize="12" Foreground="#FF5722" Text="â³" Margin="-3,0,2,0"
                                                       ToolTip="Old version available"
                                                       RenderTransformOrigin="0,0.5">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsOldVersion}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                                <TextBlock.RenderTransform>
                                                    <ScaleTransform ScaleX="1.0" ScaleY="1.0"/>
                                                </TextBlock.RenderTransform>
                                            </TextBlock>
                                            
                                            <!-- Damaged Package indicator -->
                                            <TextBlock FontSize="12" Foreground="#F44336" Text="{Binding DamageIndicator}" Margin="0,0,2,0"
                                                       ToolTip="{Binding DamageTooltip}">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsDamaged}" Value="True">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="Deps: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding DependencyCount}" FontWeight="Bold"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Dependents: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding DependentsCount}" FontWeight="Bold"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Size: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding FileSizeFormatted}" FontWeight="Bold"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Date: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding DateFormatted}" FontWeight="Bold"/>
                                        </StackPanel>
                                        <TextBlock FontSize="10" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Margin="0,2,0,0" TextWrapping="Wrap"
                                                   Text="{Binding Converter={StaticResource ContentCountsConverter}}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Scenes List -->
                <DataGrid x:Name="ScenesDataGrid" Grid.Row="1" BorderThickness="1" SelectionMode="Extended"
                          SelectionChanged="ScenesDataGrid_SelectionChanged"
                          MouseDoubleClick="ScenesDataGrid_MouseDoubleClick"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          ScrollViewer.CanContentScroll="True"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="False"
                          ScrollViewer.IsDeferredScrollingEnabled="False"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="True"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          IsReadOnly="True"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="None"
                          RowHeaderWidth="0"
                          RowHeight="65"
                          Background="Transparent"
                          Margin="0,0,0,8"
                          FontSize="12"
                          RowStyle="{StaticResource RoundedDataGridRowStyle}"
                          Visibility="Collapsed">
                    <DataGrid.Resources>
                        <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource DataGridScrollBarStyle}"/>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <!-- Thumbnail Column -->
                        <DataGridTemplateColumn Width="70" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="#1e1e1e" BorderBrush="#444444" BorderThickness="1" CornerRadius="{StaticResource CornerRadiusValue}" Margin="3" Width="60" Height="60" ClipToBounds="True">
                                        <Image Source="{Binding ThumbnailPath}" Stretch="UniformToFill" StretchDirection="Both"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <!-- Scene Info Column -->
                        <DataGridTemplateColumn Width="*" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="8" Orientation="Vertical">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                            <TextBlock FontSize="14" FontWeight="Bold" Text="{Binding DisplayName}" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                            <TextBlock FontSize="14" FontWeight="Bold" Text="â¤ï¸" Foreground="#FF6B6B" Margin="6,0,0,0" VerticalAlignment="Center" ToolTip="Marked as favorite" Visibility="{Binding IsFavorite, Converter={StaticResource BoolToVis}}"/>
                                            <TextBlock FontSize="14" FontWeight="Bold" Text="ðŸ™ˆ" Foreground="#6B9EFF" Margin="6,0,0,0" VerticalAlignment="Center" ToolTip="Hidden" Visibility="{Binding IsHidden, Converter={StaticResource BoolToVis}}"/>
                                            <TextBlock FontSize="14" FontWeight="Bold" Text="{Binding OptimizationIcon}" Foreground="#FFD700" Margin="6,0,0,0" VerticalAlignment="Center" ToolTip="Scene has been optimized"/>
                                            <TextBlock FontSize="11" Foreground="#888888" Text=" â€¢ " Margin="6,0" VerticalAlignment="Center"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding SceneType}" VerticalAlignment="Center"/>
                                            <TextBlock FontSize="11" Foreground="#888888" Text=" â€¢ " Margin="6,0" VerticalAlignment="Center"/>
                                            <TextBlock FontSize="12" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding SourceIcon}" VerticalAlignment="Center" Margin="0,0,3,0"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding Source}" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="Atoms: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding AtomCountDisplay}" FontWeight="Bold"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Deps: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding DependencyCount}" FontWeight="Bold"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Size: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding FileSizeFormatted}" FontWeight="Bold"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Date: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding DateFormatted}" FontWeight="Bold"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Custom Atom Items List -->
                <DataGrid x:Name="CustomAtomDataGrid" Grid.Row="1" BorderThickness="1" SelectionMode="Extended"
                          SelectionChanged="CustomAtomDataGrid_SelectionChanged"
                          MouseDoubleClick="CustomAtomDataGrid_MouseDoubleClick"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          ScrollViewer.CanContentScroll="True"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="False"
                          ScrollViewer.IsDeferredScrollingEnabled="False"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="True"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          IsReadOnly="True"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="None"
                          RowHeaderWidth="0"
                          RowHeight="65"
                          Background="Transparent"
                          Margin="0,0,0,8"
                          FontSize="12"
                          RowStyle="{StaticResource RoundedDataGridRowStyle}"
                          Visibility="Collapsed">
                    <DataGrid.Resources>
                        <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource DataGridScrollBarStyle}"/>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <!-- Thumbnail Column -->
                        <DataGridTemplateColumn Width="70" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="#1e1e1e" BorderBrush="#444444" BorderThickness="1" CornerRadius="{StaticResource CornerRadiusValue}" Margin="3" Width="60" Height="60" ClipToBounds="True">
                                        <Image Source="{Binding ThumbnailPath}" Stretch="UniformToFill" StretchDirection="Both"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <!-- Custom Atom Item Info Column -->
                        <DataGridTemplateColumn Width="*" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="8" Orientation="Vertical">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                            <TextBlock FontSize="14" FontWeight="Bold" Text="{Binding DisplayName}" Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                            <TextBlock FontSize="14" FontWeight="Bold" Text="â¤ï¸" Foreground="#FF6B6B" Margin="6,0,0,0" VerticalAlignment="Center" ToolTip="Marked as favorite" Visibility="{Binding IsFavorite, Converter={StaticResource BoolToVis}}"/>
                                            <TextBlock FontSize="14" FontWeight="Bold" Text="ðŸ™ˆ" Foreground="#6B9EFF" Margin="6,0,0,0" VerticalAlignment="Center" ToolTip="Hidden" Visibility="{Binding IsHidden, Converter={StaticResource BoolToVis}}"/>
                                            <TextBlock FontSize="11" Foreground="#888888" Text=" â€¢ " Margin="6,0" VerticalAlignment="Center"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding Category}" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="Path: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding Subfolder}" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Size: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding FileSizeFormatted}" FontWeight="Bold"/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="  â€¢  Date: "/>
                                            <TextBlock FontSize="11" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" Text="{Binding DateFormatted}" FontWeight="Bold"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Package Action Button Bar -->
                <Border x:Name="PackageButtonBar" Grid.Row="2"  
                        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" 
                        BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                        BorderThickness="0" CornerRadius="6" Padding="0" Margin="0,0,0,0"
                        VerticalAlignment="Top"
                        Visibility="Visible">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <Trigger Property="Visibility" Value="Visible">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                               From="0.0" To="1.0" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <Grid x:Name="ButtonLayoutGrid" VerticalAlignment="Top" Margin="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Load/Unload buttons -->
                        <UniformGrid x:Name="PackageButtonGrid" Grid.Column="0" Rows="2" Columns="2" Visibility="Visible" VerticalAlignment="Top" HorizontalAlignment="Stretch" Margin="0,6,0,0">
                            <Button x:Name="LoadPackagesButton" Content="ðŸ“‚ Load" 
                                Margin="0,0,3,0" Padding="0,0" Height="36"
                                Click="LoadPackages_Click"
                                ToolTip="Load selected packages"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button x:Name="UnloadPackagesButton" Content="ðŸ”“ Unload" 
                                Margin="3,0,0,0" Padding="0" Height="36"
                                Click="UnloadPackages_Click"
                                ToolTip="Unload selected packages"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                        </Trigger>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button x:Name="LoadPackagesWithDepsButton" Content="ðŸ“‚ Load +Deps" 
                                Margin="0,0,3,0" Padding="0" Height="36"
                                Click="LoadPackagesWithDeps_Click"
                                ToolTip="Load selected packages and their dependencies"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                        </Trigger>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button x:Name="ArchiveOldButton" Content="ðŸ“¦ Archive" 
                                Margin="3,0,0,0" Padding="0,0,0,0" Height="36"
                                Click="ArchiveOldButton_Click"
                                ToolTip="Archive selected old version packages"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="#FF9800"/>
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="BorderBrush" Value="#F57C00"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </UniformGrid>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        
        <!-- Splitter -->
        <GridSplitter Grid.Column="3" Width="2" HorizontalAlignment="Stretch" 
                      Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
        
        <!-- Right Panel - Dependencies & Info -->
        <Border Grid.Column="4" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" 
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                BorderThickness="1" CornerRadius="{StaticResource CornerRadiusValue}">
            <Grid Margin="6">
                <Grid.RowDefinitions>
                    <!-- Dependencies Search -->
                    <RowDefinition Height="Auto"/>
                    <!-- Dependencies List + Button Bar: Adjustable height -->
                    <RowDefinition Height="0.5*" MinHeight="100" x:Name="DepsListRow"/>
                    <!-- Splitter Row: Fixed height for resizing -->
                    <RowDefinition Height="5" x:Name="SplitterRow"/>
                    <!-- Package Information Tabs: Adjustable height -->
                    <RowDefinition Height="0.5*" MinHeight="200" x:Name="InfoRow"/>
                </Grid.RowDefinitions>
                
                <Grid.Resources>
                    <Style TargetType="DataGrid">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                    </Style>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                        <Setter Property="Background" Value="Transparent"/>
                    </Style>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                        <Setter Property="Background" Value="Transparent"/>
                    </Style>
                </Grid.Resources>
                
                <!-- Dependencies Tabs -->
                <Grid x:Name="DependenciesTabsContainer" Grid.Row="0" Margin="0,0,0,8" MouseWheel="DependenciesTabs_MouseWheel">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Tab Headers -->
                    <Grid Grid.Row="0" Margin="0,0,0,0" x:Name="TabHeadersGrid">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*" x:Name="DependentsTabColumn"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button x:Name="DependenciesTab" Grid.Column="0"
                                Padding="10,6"
                                FontSize="12"
                                Click="DependenciesTab_Click"
                                Margin="0,0,1,0"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Dependencies " VerticalAlignment="Center"/>
                                    <TextBlock x:Name="DependenciesCountText" Text="(0)" VerticalAlignment="Center" FontWeight="Bold"/>
                                </StackPanel>
                            </Button.Content>
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="FontWeight" Value="Normal"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Tag}" Value="Active">
                                            <Setter Property="Background" Value="#FF505050"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="BorderBrush" Value="#FF505050"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button x:Name="DependentsTab" Grid.Column="1"
                                Padding="10,6"
                                FontSize="12"
                                Click="DependentsTab_Click"
                                Margin="1,0,0,0"
                                VerticalAlignment="Stretch"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center">
                            <Button.Content>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Dependents " VerticalAlignment="Center"/>
                                    <TextBlock x:Name="DependentsCountText" Text="(0)" VerticalAlignment="Center" FontWeight="Bold"/>
                                </StackPanel>
                            </Button.Content>
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="FontWeight" Value="Normal"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Tag}" Value="Active">
                                            <Setter Property="Background" Value="#FF505050"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="BorderBrush" Value="#FF505050"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                    
                    <!-- Search Bar -->
                    <Grid Grid.Row="1" Margin="0,6,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox x:Name="DepsSearchBox" Grid.Column="0"
                                 Text="ðŸ“ Filter dependencies..." 
                                 Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"
                                 Padding="6"
                                 GotFocus="FilterTextBox_GotFocus" 
                                 LostFocus="FilterTextBox_LostFocus"
                                 TextChanged="DepsSearchBox_TextChanged"/>
                        <Button x:Name="DepsSearchClearButton" Grid.Column="1" 
                                Content="âœ•" 
                                Margin="3,0,0,0" Padding="3,0" FontSize="12" FontWeight="Bold"
                                Click="ClearFilterButton_Click"
                                ToolTip="Clear filter"
                                Visibility="Collapsed"
                                VerticalAlignment="Center"
                                MinWidth="30">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Width" Value="{Binding ElementName=DepsSearchBox, Path=ActualHeight}"/>
                                    <Setter Property="Height" Value="{Binding ElementName=DepsSearchBox, Path=ActualHeight}"/>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button x:Name="DependenciesSortButton" Grid.Column="2" 
                                Content="â‡…" 
                                Margin="3,0,0,0" Padding="0" FontSize="15" FontWeight="Bold"
                                Click="DependenciesSortButton_Click"
                                MouseWheel="DependenciesSortButton_MouseWheel"
                                ToolTip="Sort dependencies (Scroll to navigate)"
                                VerticalAlignment="Center"
                                MinWidth="30">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Width" Value="{Binding ElementName=DepsSearchBox, Path=ActualHeight}"/>
                                    <Setter Property="Height" Value="{Binding ElementName=DepsSearchBox, Path=ActualHeight}"/>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Grid Grid.Column="3" Margin="3,0,0,0">
                            <Button x:Name="DownloadMissingButton" 
                                    Content="â€¦" 
                                    Padding="0" FontSize="15" FontWeight="Bold"
                                    Click="DownloadMissingButton_Click"
                                    ToolTip="Download selected missing dependencies"
                                    Visibility="Collapsed"
                                    Background="#FF4CAF50"
                                    Foreground="White"
                                    MinWidth="30">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                        <Setter Property="Background" Value="#FF4CAF50"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="Width" Value="{Binding ElementName=DepsSearchBox, Path=ActualHeight}"/>
                                        <Setter Property="Height" Value="{Binding ElementName=DepsSearchBox, Path=ActualHeight}"/>
                                    </Style>
                                </Button.Style>
                            </Button>
                            
                            <!-- Download counter badge -->
                            <Border x:Name="DownloadCounterBadge"
                                    Background="#FF2196F3"
                                    CornerRadius="9"
                                    MinWidth="16"
                                    Height="16"
                                    Padding="3,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top"
                                    Margin="0,-6,-6,0"
                                    Visibility="Collapsed">
                                <TextBlock x:Name="DownloadCounterText"
                                           Text="0"
                                           FontSize="9"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Grid>
                </Grid>
                
                <!-- Dependencies Container (List + Button Bar) -->
                <Grid Grid.Row="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Dependencies List -->
                    <DataGrid x:Name="DependenciesDataGrid" Grid.Row="0" BorderThickness="1" BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" SelectionMode="Extended"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          VirtualizingPanel.CacheLength="10,10"
                          VirtualizingPanel.CacheLengthUnit="Item"
                          VirtualizingPanel.ScrollUnit="Item"
                          VirtualizingPanel.IsContainerVirtualizable="True"
                          ScrollViewer.CanContentScroll="True"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="False"
                          ScrollViewer.IsDeferredScrollingEnabled="False"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="False"
                          CanUserResizeColumns="True"
                          CanUserSortColumns="True"
                          IsReadOnly="True"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="None"
                          RowHeaderWidth="0"
                          RowHeight="24"
                          Background="Transparent"
                          Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"
                          FontSize="12"
                          Padding="0,1,0,0">
                    <DataGrid.Resources>
                        <Style TargetType="{x:Type ScrollBar}" BasedOn="{StaticResource DataGridScrollBarStyle}"/>
                    </DataGrid.Resources>
                    <DataGrid.ColumnHeaderStyle>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                            <Setter Property="BorderThickness" Value="0,0,1,1"/>
                            <Setter Property="Padding" Value="8,6"/>
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="HorizontalContentAlignment" Value="Left"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                        </Style>
                    </DataGrid.ColumnHeaderStyle>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#1A1A1A"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                    <DataGrid.Columns>
                        <!-- Status Column -->
                        <DataGridTemplateColumn Header="Status" Width="28" CanUserResize="False" CanUserSort="True" SortMemberPath="Status">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Ellipse Width="12" Height="12" 
                                             Fill="{Binding StatusColor, Converter={x:Static local:ColorToBrushConverter.Instance}}"
                                             HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <!-- Dependency Name Column -->
                        <DataGridTextColumn Header="Dependency Name" Binding="{Binding DisplayName}" Width="*" 
                                            CanUserSort="True" SortMemberPath="DisplayName">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                    </DataGrid>
                    
                    <!-- Dependencies Action Button Bar -->
                    <Border x:Name="DependenciesButtonBar" Grid.Row="1" 
                        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" 
                        BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                        BorderThickness="0" CornerRadius="{StaticResource CornerRadiusValue}" Padding="0,0" Margin="0,0,0,9"
                        Visibility="Collapsed">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <Trigger Property="Visibility" Value="Visible">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                               From="0.0" To="1.0" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <Grid x:Name="DependenciesButtonGrid" HorizontalAlignment="Stretch" Margin="9,9,9,9">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Load / Unload positioned programmatically via code-behind for adaptive layout -->
                            <Button x:Name="LoadDependenciesButton" Grid.Row="0" Grid.Column="0" Content=" Load" 
                                    Margin="3" Padding="0" Height="33"
                                    Click="LoadDependencies_Click"
                                    ToolTip="Load selected dependencies"
                                    FontSize="12" FontWeight="SemiBold"
                                    Visibility="Collapsed">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                        <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="{StaticResource CornerRadiusValue}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                            </Trigger>
                                            <Trigger Property="Visibility" Value="Visible">
                                                <Trigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                           From="0.0" To="1.0" Duration="0:0:0.15">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </Trigger.EnterActions>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            <Button x:Name="UnloadDependenciesButton" Grid.Row="0" Grid.Column="1" Content=" Unload" 
                                    Margin="3" Padding="0" Height="33"
                                    Click="UnloadDependencies_Click"
                                    ToolTip="Unload selected dependencies"
                                    FontSize="12" FontWeight="SemiBold"
                                    Visibility="Collapsed">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                        <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="{StaticResource CornerRadiusValue}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                            </Trigger>
                                            <Trigger Property="Visibility" Value="Visible">
                                                <Trigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                           From="0.0" To="1.0" Duration="0:0:0.15">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </Trigger.EnterActions>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            <Button x:Name="OptimizeDependenciesButton" Grid.Row="1" Grid.Column="0" Content="âš¡ï¸ Optimize" 
                                    Margin="3" Padding="0" Height="33"
                                    Click="OptimizeDependencies_Click"
                                    ToolTip="Optimize selected dependencies"
                                    FontSize="12" FontWeight="SemiBold"
                                    Visibility="Collapsed">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                        <Setter Property="BorderBrush" Value="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="{StaticResource CornerRadiusValue}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderBrush" Value="#FF0078D7"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                            </Trigger>
                                            <Trigger Property="Visibility" Value="Visible">
                                                <Trigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                           From="0.0" To="1.0" Duration="0:0:0.15">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </Trigger.EnterActions>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                    </Grid>
                    </Border>
                </Grid>
                
                <!-- Splitter between Deps and Tabs -->
                <GridSplitter Grid.Row="2" Height="6" HorizontalAlignment="Stretch"
                              ResizeBehavior="PreviousAndNext" ShowsPreview="True"
                              Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                              x:Name="DepsInfoSplitter"
                              Cursor="SizeNS"/>
                
                <!-- Package Information Tabs -->
                <TabControl x:Name="PackageInfoTabControl" Grid.Row="3" 
                            BorderThickness="1"
                            BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                            Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                            Margin="0,9,0,0"
                            VerticalAlignment="Stretch"
                            VerticalContentAlignment="Stretch">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Border Name="Border" 
                                                BorderThickness="1,1,1,0" 
                                                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                                                Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                                                CornerRadius="3,3,0,0"
                                                Padding="12,6"
                                                Margin="2,0,0,0">
                                            <ContentPresenter x:Name="ContentSite"
                                                            VerticalAlignment="Center"
                                                            HorizontalAlignment="Center"
                                                            ContentSource="Header"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Border" Property="BorderBrush" Value="#FF0078D7"/>
                                                <Setter TargetName="Border" Property="BorderThickness" Value="1,1,1,0"/>
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Border" Property="Background" 
                                                        Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>
                    
                    <!-- Tab Header Panel with scroll support -->
                    <TabControl.Template>
                        <ControlTemplate TargetType="TabControl">
                            <Grid KeyboardNavigation.TabNavigation="Local" VerticalAlignment="Stretch">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <!-- Tab Headers with wrapping support -->
                                <WrapPanel Grid.Row="0" Orientation="Horizontal" 
                                          PreviewMouseWheel="PackageInfoTabs_PreviewMouseWheel"
                                          IsItemsHost="True" KeyboardNavigation.TabIndex="1" Panel.ZIndex="1"/>
                                <!-- Tab Content with background -->
                                <Border Grid.Row="1" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" CornerRadius="0,0,4,4" VerticalAlignment="Stretch">
                                    <ContentPresenter Name="PART_SelectedContentHost" 
                                                     ContentSource="SelectedContent" Margin="{TemplateBinding Padding}" VerticalAlignment="Stretch"/>
                                </Border>
                            </Grid>
                        </ControlTemplate>
                    </TabControl.Template>
                    
                    <!-- Default tab - Package Information -->
                    <TabItem Header="Package Info">
                        <TabItem.Resources>
                            <!-- Custom style to override fixed height from theme -->
                            <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                <Setter Property="Height" Value="Auto"/>
                                <Setter Property="VerticalAlignment" Value="Stretch"/>
                                <Setter Property="VerticalContentAlignment" Value="Top"/>
                            </Style>
                        </TabItem.Resources>
                        <ScrollViewer BorderThickness="0" 
                                      HorizontalScrollBarVisibility="Disabled"
                                      VerticalScrollBarVisibility="Auto"
                                      Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                                      VerticalAlignment="Stretch"
                                      Padding="0">
                            <TextBox Name="PackageInfoTextBlock" 
                                     Text="Select a package to view details..."
                                     Padding="0" 
                                     TextWrapping="Wrap"
                                     IsReadOnly="True"
                                     BorderThickness="0"
                                     Background="Transparent"
                                     MinHeight="100"
                                     VerticalAlignment="Stretch"
                                     Margin="0"
                                     VerticalContentAlignment="Top"/>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
                
            </Grid>
        </Border>
        
        <!-- Splitter -->
        <GridSplitter Grid.Column="5" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                      ResizeBehavior="PreviousAndNext" ShowsPreview="True"
                      Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                      Cursor="SizeWE"/>
        
        <!-- Right Panel - Images with Preview -->
        <Border Grid.Column="6" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" 
                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                BorderThickness="1" CornerRadius="{StaticResource CornerRadiusValue}">
            <Grid Margin="6">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*" MinHeight="200"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="0" x:Name="PreviewRowDefinition" MinHeight="0"/>
                </Grid.RowDefinitions>
                
                <!-- Toolbar Buttons -->
                <Border x:Name="ImagesToolbarButtonBar" Grid.Row="0"  
                        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}" 
                        BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}" 
                        BorderThickness="0" CornerRadius="6" Padding="0" Margin="0,0,0,6"
                        VerticalAlignment="Top">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <Trigger Property="Visibility" Value="Visible">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                               From="0.0" To="1.0" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <QuadraticEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <StackPanel x:Name="ImagesToolbarButtonGrid" Orientation="Horizontal" Visibility="Visible" VerticalAlignment="Top" HorizontalAlignment="Stretch" Margin="0">
                        <!-- Normal buttons -->
                        <Button x:Name="PackageDownloadsImageButton" 
                                Content="ðŸ“¥ Package Downloads" 
                                Margin="0,0,3,0" Padding="8,0" Height="36"
                                Click="PackageDownloadsToolbar_Click"
                                ToolTip="Search and download missing packages"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Visible">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button x:Name="CheckUpdatesImageButton" 
                                Content="ðŸ”„ Check for Updates" 
                                Margin="3,0,3,0" Padding="8,0" Height="36"
                                Click="CheckUpdatesToolbar_Click"
                                ToolTip="Check for package updates"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Visible">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button x:Name="PlayVAMImageButton" 
                                Content="ðŸŽ® Play VAM" 
                                Margin="3,0,0,0" Padding="8,0" Height="36"
                                Click="PlayVaM_Click"
                                ToolTip="Launch VAM"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Visible">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <!-- Play mode buttons (Desktop/VR/Custom/Cancel) -->
                        <Button x:Name="DesktopImageButton" 
                                Content="ðŸ–¥ï¸ Desktop" 
                                Margin="0,0,3,0" Padding="8,0" Height="36"
                                Click="LaunchDesktop_Click"
                                ToolTip="Launch VirtAMate in Desktop mode"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button x:Name="VRImageButton" 
                                Content="ðŸ¥½ VR" 
                                Margin="3,0,3,0" Padding="8,0" Height="36"
                                Click="LaunchVR_Click"
                                ToolTip="Launch VirtAMate in VR mode"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button x:Name="CustomImageButton" 
                                Content="âš™ï¸ Custom" 
                                Margin="3,0,3,0" Padding="8,0" Height="36"
                                Click="LaunchConfig_Click"
                                ToolTip="Launch VirtAMate with screen selector"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button x:Name="CancelImageButton" 
                                Content="âœ• Cancel" 
                                Margin="3,0,0,0" Padding="8,0" Height="36"
                                Click="CancelPlay_Click"
                                ToolTip="Cancel and return to main buttons"
                                FontSize="12" FontWeight="SemiBold"
                                Visibility="Collapsed">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource BlueHoverButtonStyle}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderBrush="{TemplateBinding BorderBrush}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="Center" 
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                                                                       From="0.0" To="1.0" Duration="0:0:0.15">
                                                            <DoubleAnimation.EasingFunction>
                                                                <QuadraticEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Border>
                
                <!-- Main images area with overlay controls -->
                <Grid Grid.Row="1">
                    <ScrollViewer x:Name="ImagesScrollViewer" BorderThickness="1"
                                  HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto"
                                  BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                                  PreviewMouseWheel="ImagesScrollViewer_PreviewMouseWheel"
                                  ScrollChanged="OnProgressiveScrollChanged">
                    <ScrollViewer.Template>
                        <ControlTemplate TargetType="ScrollViewer">
                            <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{StaticResource CornerRadiusValue}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ScrollContentPresenter Grid.Row="0" Grid.Column="0"/>
                                    <ScrollBar Grid.Row="0" Grid.Column="1" Name="PART_VerticalScrollBar"
                                               Orientation="Vertical"
                                               Value="{TemplateBinding VerticalOffset}"
                                               Maximum="{TemplateBinding ScrollableHeight}"
                                               ViewportSize="{TemplateBinding ViewportHeight}"
                                               Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"/>
                                    <ScrollBar Grid.Row="1" Grid.Column="0" Name="PART_HorizontalScrollBar"
                                               Orientation="Horizontal"
                                               Value="{TemplateBinding HorizontalOffset}"
                                               Maximum="{TemplateBinding ScrollableWidth}"
                                               ViewportSize="{TemplateBinding ViewportWidth}"
                                               Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"/>
                                </Grid>
                            </Border>
                        </ControlTemplate>
                    </ScrollViewer.Template>
                    <StackPanel x:Name="ImagesPanel" Margin="3">
                        <!-- Images will be populated dynamically -->
                        <Border HorizontalAlignment="Stretch" Padding="12">
                            <TextBlock Text="No images available"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap"
                                       Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
                
                <!-- Hoverable overlay controls - positioned at bottom right of image area -->
                <Border x:Name="ImageControlsOverlay"
                        HorizontalAlignment="Right" 
                        VerticalAlignment="Bottom" 
                        Margin="0,0,16,16"
                        Background="#CC000000" 
                        CornerRadius="6"
                        Opacity="0.4"
                        Panel.ZIndex="10">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Opacity" Value="1"/>
                                    <Setter Property="Background" Value="#E6000000"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <Grid Margin="6,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Column adjustment buttons on the right -->
                        <StackPanel Orientation="Horizontal" Grid.Column="2">
                            <Button Content="âˆ’" Width="26" Height="26" Margin="0,0,3,0" 
                                    Click="DecreaseImageColumns_Click"
                                    ToolTip="Decrease columns (Ctrl+-)"
                                    FontSize="12"
                                    Padding="0,0"
                                    FontWeight="Bold">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="#40FFFFFF"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="BorderBrush" Value="#60FFFFFF"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="{StaticResource CornerRadiusValue}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#80FFFFFF"/>
                                                            <Setter Property="BorderBrush" Value="#FFFFFFFF"/>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter Property="Background" Value="#A0FFFFFF"/>
                                                            <Setter Property="BorderBrush" Value="#FFFFFFFF"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                            <Button Content="+" Width="26" Height="26" 
                                    Click="IncreaseImageColumns_Click"
                                    ToolTip="Increase columns (Ctrl++)"
                                    FontSize="12"
                                    Padding="0,0"
                                    FontWeight="Bold">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="#40FFFFFF"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Setter Property="BorderBrush" Value="#60FFFFFF"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="{StaticResource CornerRadiusValue}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                          VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#80FFFFFF"/>
                                                            <Setter Property="BorderBrush" Value="#FFFFFFFF"/>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter Property="Background" Value="#A0FFFFFF"/>
                                                            <Setter Property="BorderBrush" Value="#FFFFFFFF"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                </Grid>
                
                <!-- Preview Panel Splitter -->
                <GridSplitter x:Name="PreviewSplitter" Grid.Row="2" Height="5" 
                              HorizontalAlignment="Stretch" VerticalAlignment="Center"
                              ResizeBehavior="PreviousAndNext" ShowsPreview="True"
                              Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                              Cursor="SizeNS" Visibility="Collapsed"/>
                
                <!-- Preview Panel -->
                <Border x:Name="PreviewPanel" Grid.Row="3" 
                        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                        BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                        BorderThickness="1,1,1,0" CornerRadius="0,0,3,3"
                        Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Preview Header with Search -->
                        <Border Grid.Row="0" Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                                BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                                BorderThickness="0,0,0,1" Padding="8,6">
                            <Grid x:Name="PreviewSearchPanel" Visibility="Collapsed">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Title/Label -->
                                <TextBlock x:Name="PreviewHeaderText" Grid.Column="0" 
                                           Text="Preview" FontWeight="SemiBold" FontSize="12"
                                           VerticalAlignment="Center" Margin="0,0,15,0"
                                           Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                
                                <!-- Search label -->
                                <TextBlock Grid.Column="1" Text="ðŸ“ Search:" VerticalAlignment="Center"
                                           Margin="0,0,9,0" FontWeight="SemiBold" FontSize="12"
                                           Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                
                                <!-- Search textbox -->
                                <TextBox x:Name="PreviewSearchBox" Grid.Column="2" Height="27" 
                                         VerticalAlignment="Center" VerticalContentAlignment="Center"
                                         Margin="0,0,9,0" Padding="6,3,6,3" FontSize="12"/>
                                
                                <!-- Match counter -->
                                <TextBlock x:Name="PreviewMatchCounter" Grid.Column="3" 
                                           VerticalAlignment="Center" Margin="0,0,9,0" MinWidth="81"
                                           FontSize="12" FontWeight="SemiBold" TextAlignment="Right"
                                           Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                                
                                <!-- Case sensitivity toggle -->
                                <CheckBox x:Name="PreviewCaseToggle" Grid.Column="4" Content="Aa"
                                          VerticalAlignment="Center" Margin="0,0,3,0" FontSize="9" FontWeight="Bold"
                                          ToolTip="Match case"/>
                                
                                <!-- Previous button -->
                                <Button x:Name="PreviewPrevButton" Grid.Column="5" Content="â€“Â²" 
                                        Width="27" Height="27" Margin="0,0,3,0" FontSize="12" FontWeight="Bold"
                                        ToolTip="Previous match (Shift+Enter)"/>
                                
                                <!-- Next button -->
                                <Button x:Name="PreviewNextButton" Grid.Column="6" Content="â€“Â¼" 
                                        Width="27" Height="27" Margin="0,0,3,0" FontSize="12" FontWeight="Bold"
                                        ToolTip="Next match (Enter)"/>
                                
                                <!-- Close button -->
                                <Button x:Name="ClosePreviewButton" Grid.Column="7" Content="âœ•" 
                                        Width="21" Height="21" FontSize="9" FontWeight="Bold"
                                        Click="ClosePreview_Click"
                                        ToolTip="Close preview"
                                        Background="Transparent" BorderThickness="0"
                                        Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" 
                                                                CornerRadius="3" Padding="2">
                                                            <ContentPresenter HorizontalAlignment="Center" 
                                                                              VerticalAlignment="Center"/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#20FF0000"/>
                                                            </Trigger>
                                                            <Trigger Property="IsPressed" Value="True">
                                                                <Setter Property="Background" Value="#40FF0000"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>
                        </Border>
                        
                        <!-- Preview Content Area -->
                        <ScrollViewer x:Name="PreviewContentScrollViewer" Grid.Row="1" 
                                      HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"
                                      Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
                                      Padding="8">
                            <ContentPresenter x:Name="PreviewContentPresenter"/>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Border>
        </Grid>
    </DockPanel>
</Window>
